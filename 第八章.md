		第八章		存储管理

存储设备的查看

	硬盘结构
	
		机械硬盘
		
				磁盘盘片	磁头	主轴	传动轴
				____|____
			   |         |
			 扇区       磁道
			 
			两个磁头中间是盘片
			磁盘上等距离外向内分布磁道
			盘片分为若干个弧段,称为扇区
			磁盘由外磁道向内工作
			
			磁盘大小 = 磁头数(磁盘面) x 柱面数(磁道) x 扇区数 x 每个扇区的大小
			
			接口
				IDE:早期机械硬盘使用(ATA磁盘)
				SATA:(序列ATA),高速传输,纠错
				SCSI：小型计算机系统接口。服务器
			
		固态硬盘
			
			采用储存芯片存储数据
			存储介质
					闪存
					DRAM
	
	硬盘识别
	
		系统初始化MBR（主引导记录）识别硬盘，MBR占据每个磁道第一个扇区
		MBR（512B）分为boot loader（446B），patition table（16x4B），结束标志（2B）
		存储信息包括分区号，分区起始柱面和分区柱面数
		分区号：
				0x5		可扩展分区
				0x82	交换区
				0x83	普通linux分区
				0x8e	linux逻辑卷管理分区
				0xfd	linux的RAID分区
				
		分区主要作用
			方便管理和控制
			提高系统的效率
			使用磁盘配额的功能限制用户使用的磁盘量
			便于备份和恢复
			
	存储设备的挂载
	
		硬件设备需挂载后方可使用
		
		mount -l		已挂载设备信息
		mount -a		自动挂载			
						检查/etc/fstab自动挂载文件，自动操作遗漏挂载的设备文件
		mount [-t 系统类型] [-L 卷标名] [-o 特殊选项] [-n] 设备文件名 挂载点（目录）
			
			特殊选项
					rw/ro		
						是否对挂载的文件系统拥有读/写权限，rw默认读写；ro只读
					async/sync
						文件系统是否使用同步或异步的内存机制，默认async
					dev/nodev
						是否允许从文件系统的block文件中提取数据，为了保证数据安装，默认dev
					auto/noauto
						是否允许文件系统被mount -a方式自动挂载，默认auto
					suid/nosuid
						设定文件系统是否拥有SetUID和SetGID权限，默认suid
					exec/noexec
						设定在文件系统中是否允许执行可执行文件，默认exec
					user/nouser
						设定文件系统是否允许让普通用户使用mount执行挂载操作，默认nouser
					defaults
						定义默认值，相当于以上七个选项
					remount
						重新挂载已挂载的文件系统，用于指定修改特殊权限
			
		挂载光盘
			mount -t iso9660 文件系统 挂载目录
			挂载实质为软链接到设备文件名，也可使用设备文件名进行挂载
		
		挂载U盘
			fdisk -l	查找U盘设备名
			mount -t vfat 设备文件 挂载目录
			mount -t vfat -o iocharset=utf8 设备文件 挂载目录		解决win和linux中文编码不一致乱码问题
			
			echo $LANG		linux默认编码格式
			
		linux支持NTFS格式的移动硬盘
			重新编译内核，加入NTFS模块，安装模块即可
			下载编译内核安装；
			安装NTFS文件系统三方插件；
			
		自动挂载
			/etc/fstab文件内容字段
				
				第一字段
					挂载每个文件系统得分区设备文件名或UUID（唯一识别符）
				第二字段
					挂载点（已建立空目录）
				第三字段
					文件系统的类型（默认文件系统ext4）
				第四字段
					各种挂载参数（和mount参数一致）
				第五字段
					指定分区是否被dump备份（备份文件系统；0不备份，1备份，2不定期备份）
				第六字段
					指定分区是否被fsck检测
					（指定分区是否被fsck检测，检查和维护文件系统；0不检测，其它数字优先级，1最大）

分区管理
				
	fdisk命令
		
		fdisk -l			
				查询被禁可以识别的硬盘和分区
		fdisk 设备文件名
				给磁盘分区	
				
			交互命令
				a		设置可引导标记
				b		编辑bsd磁盘标签
				c		设置DOS操作系统兼容标记
				d		删除一个分区
				l		显示已知文件系统类型：82swap分区，83linux分区
				m		帮助
				n		新建分区
				o		建立空白DOS分区表
				p		显示分区列表
				q		不保存退出
				s		新建空白SUN磁盘标签
				t		改变一个分区的系统ID
				u		改变显示记录单位
				v		验证分区表
				w		保存退出
				x		附加功能
				
				
	parted命令
	
		parted 硬盘设备文件名
				大容量磁盘分区和格式化

磁盘管理工具

	df命令
		各文件系统磁盘使用情况
		
		df [选项] [目录文件名]
			选项
				-a		显示所有文件系统信息
				-m		以MB为单位显示
				-k		以KB为单位显示
				-h		使用人们习惯的单位自行显示容量
				-T		显示该分区的文件系统名称
				-i		不显示磁盘容量，而显示inode的数量
				
	du命令
		统计目录或文件所占磁盘空间
			du [选项] [目录文件名]
				选项
					-a		显示所有子目录和子文件的磁盘占用量
					-h		使用习惯单位显示磁盘占用量
					-s		统计总磁盘占用量，而不列出子目录和子文件的磁盘占用量
	
	fsck命令
		检查文件系统并尝试修复出现的错误（操作前先备份）
			fsck [选项] 分区设备文件名
				选项
					-a		自动修复文件系统，无提示信息
					-r		采取交互模式
					-A		按照/etc/fstab配置文件的内容，检查文件内罗列的全部文件系统
					-t 文件系统类型		指定要检查的文件系统类型
					-C		显示检查分区的进度条
					-f		强制检查；默认fsck不会检测未发现问题的分区
					-y		自动修复

磁盘阵列（RAID）
	
	raid特点数据冗余性，保护数据
	
	RAID方案
		RAID 0
			多块容量相同的硬盘组成
			优点
				多块硬盘合并成一块大的逻辑硬盘实现数据跨硬盘存储
				文件被均匀分割到各个硬盘中，IO速度快，且没有容量损失
			缺点
				无冗余功能
		RAID 1	镜像卷
			两块硬盘组成大小最好一致，否则以最小的硬盘为准
			优点
				数据冗余功能；数据保存到每块硬盘上，双保险
			缺点
				保存两份数据，总容量对半打折
				写入性能差
		RAID10和RAID01
			两个RAID1 组成一个RAID0
			优点
				综合了RAID0和1的优点
			缺点
				总容量打折
		RAID5
			最少3块硬盘组成，每块容量应当一致
			均匀分割文件同时在写入阶段在其中一快硬盘中加入一个奇偶校验值
			内容是这次循环写入时其它硬盘数据的备份。当有硬盘损坏时，采用
			奇偶校验值进行数据恢复
			优点
				数据冗余功能
				损失比RAID1小，组成数量越多，容量损失占比越小
				IO性能位于0和1之间
			缺点
				只支持一块硬盘损坏之后的数据恢复
				有一块硬盘用来保存奇偶校验值，不能存储数据
				
	建立RAID
		mdadm [模式] [RAID设备文件名] [选项] [成员设备名称]
			模式
				-Assemble		加入一个已经存在的阵列
				-Build			创建一个没有超级块的阵列
				-Create			创建一个阵列，每个设备都具有超级块
				-Manage			管理阵列
				-Misc			允许单独对阵列中的设备进行操作、
				-Follow or Monirot	监控RAID状态
				-Grow			改变RAID的容量和阵列中的设备数目
			选项
				-s，-scan		扫描配置文件或/proc/mdstat文件，发现丢失的信息
				-D，-detail		查看磁盘阵列详细信息
				-C，-create		建立新的磁盘阵列，也就是调用Create模式
				-a，-auto=yes	采用标准格式建立磁盘阵列
				-n，-raicklevices=数字		使用级块磁盘或分区组成备份设备
				-l，-level=级别				创建RAID级别，0，1，5
				-x，-spare-devices=数字		使用级块硬盘或分区组成备份设备
				-a，-add 设备文件名			在已存在的RAID中加入设备
				-r，-remove 设备文件名		在已存在的RAID中移出设备
				-f，-fail 设备文件名		把某个组成RAID的设备设置为错误状态
				-S,-stop					停止RAID设备
				-A，-assemble				按照配置文件加载RAID
				